\documentclass[a4paper]{article}

\usepackage[portuguese]{babel}
\usepackage{comment}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{float}
\usepackage{multirow}
\usepackage[hypcap]{caption} % makes \ref point to top of figures and tables
\usepackage{amsmath}
\usepackage{multicol} %for page layout on section Maximização do Throughput
%\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{pdflscape}	% landscape pages
\usepackage{subcaption}

\title{Projecto 3 --- Adenda}
\author{Gonçalo Ribeiro, 73294\hspace{8mm}Rafael Gonçalves, 73786}

\begin{document}
\maketitle
%\input{./rosto.tex}

%\tableofcontents

\section{Resumo}
O presente documento é uma adenda ao relatório entregue no dia 21 de Dezembro de 2014.

À data de entrega do relatório a unidade HALF estava concluída; e do SAVE faltava afinar a máquina de estados. Faltava também ligar as BRAMs, e fazer a máquina de estados que pede input ao utilizador.

Os pontos que se seguem resumem as alterações que foram feitas em relação à data de entrega do relatório.

\begin{itemize}
	\item redesenhou-se a unidade de armazenamento;
	\item adicionou-se uma segunda FSM ao módulo SAVE, que permite tratar correctamente as operações compostas;
	\item desenhou-se a FSM que permite ao utilizador introduzir os parâmetros largura, altura e tipo de operação;
	\item fizeram-se as ligações às BRAMs.
\end{itemize}

\section{Detalhes das Alterações}

\subsection*{Unidade de Armazenamento}
A unidade de armazenamento anteriormente projectada usava muitos multiplexers, o que se traduzia numa grande ocupação de hardware. Eram utilizados cerca de 224 multiplexers 4:1 com o único propósito de se conseguirem ganhar 1 a 3 ciclos. Esse ganho claramente não justifica o custo pelo que se redesenhou esta unidade.

No novo desenho existem apenas 64 multiplexers 4:1.

\subsection*{FSM do SAVE}

\subsection*{FSM de Input}
A FSM de input permite ao utilizador inserir a largura e altura da imagem bem como a operação morfológica que pretende. Decidiu-se usar o botão 0 para \textit{reset} e o botão 1 para confirmar a inserção de cada parâmetro e mandar iniciar a transformação.

A máquina de estados resultante é a da \autoref{fig:FSMinput}. No estado \texttt{start} o processamento da imagem começa. Quando a imagem acaba de ser processada a FSM passa ao estado \texttt{end}.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{controlo_FSM}
	\caption{FSM de input. Por omissão o estado não muda.}
	\label{fig:FSMinput}
\end{figure}

\subsection*{Ligação às BRAMs}
Para usar as BRAMs, os ficheiros \texttt{BlockRam.vhd} e \texttt{usb2bram.vhd} foram alterados. No primeiro passou a usar-se a RAMB16\_S9\_S36, ou seja uma BRAM com 512 posições de memória cada uma com 32 bits (mais bits de paridade). Como a largura das palavras foi alterada, no ficheiro \texttt{usb2bram.vhd} alterou-se a largura das \textit{buses} de dados dos portos B para 32 bits e a largura dos endereços desses portos para 9 bits.

De seguida, o ficheiro \texttt{controlo.vhd} foi substituido por outro contendo a FSM correspondente à \autoref{fig:FSMinput}; e \texttt{datapath.vdh} foi substituido por um componente que agrega as FSMDs do HALF e SAVE.

\end{document}
